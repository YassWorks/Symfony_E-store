{# templates/cart/index.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Your Cart
{% endblock %}
{% block body %}
	<br/>
	<br/>
	<br/>
	<div class="container py-5">
		{% if cart.items|length == 0 %}
			<div class="card shadow-sm text-center p-4">
				<div class="card-body py-5">
					<span class="material-icons-outlined" style="
						                    font-size: 64px;
						                    color: var(--secondary);
						                    margin-bottom: 1rem;
						                ">shopping_cart</span>
					<h3>Your cart is empty</h3>
					<p class="text-muted mb-4">
						Looks like you haven't added any products to your cart yet.
					</p>
					<a href="{{ path('product_index') }}" class="btn btn-primary btn-lg">
						<span class="material-icons-outlined me-2">shopping_bag</span>
						Start Shopping
					</a>
				</div>
			</div>
		{% else %}
			<div class="row g-4">
				<div class="col-lg-8">
					<div class="card shadow-sm mb-4">
						<div class="card-header bg-white">
							<h5 class="mb-0">Cart Items ({{ cart.items | length }})</h5>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-borderless align-middle mb-0">
									<thead class="bg-light">
										<tr>
											<th scope="col" class="ps-4">Product</th>
											<th scope="col" class="text-center">
												Quantity
											</th>
											<th scope="col" class="text-end">
												Unit Price
											</th>
											<th scope="col" class="text-end pe-4">
												Subtotal
											</th>
											<th scope="col" class="text-center">
												Action
											</th>
										</tr>
									</thead>
									<tbody>
										{% for item in cart.items %}
											<tr>
												<td class="ps-4">
													<div class="d-flex align-items-center">
														<div class="me-3" style="
																                                                    width: 60px;
																                                                    height: 60px;
																                                                ">
															{% if item.product.images is
                                                defined and
                                                item.product.images|length > 0
                                                %}
																{% set image =
                                                item.product.images[0] %}
																<img src="{{ asset('uploads/products_images/' ~ image.filename) }}" alt="{{ item.product.title }}" class="img-fluid rounded" style="
																                                                        width: 100%;
																                                                        height: 100%;
																                                                        object-fit: cover;
																                                                    "/>
															{% else %}
																<img src="{{ asset( 'uploads/default.jpg' ) }}" alt="Product" class="img-fluid rounded" style="
																                                                        width: 100%;
																                                                        height: 100%;
																                                                        object-fit: cover;
																                                                    "/>
															{% endif %}
														</div>
														<div>
															<h6 class="mb-0">
																{{ item.product.title }}
															</h6>
															<small class="text-muted">{{
                                                    item.product.category.value
                                                }}</small>
														</div>
													</div>
												</td>
												<td class="text-center">
													<form method="post" action="{{ path('cart_update', { itemId: item.id }) }}" class="d-flex justify-content-center align-items-center">
														<div class="input-group" style="width: 120px">
															<input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="form-control form-control-sm text-center" style="
																                                                        margin-right: -6px;
																                                                        margin-left: -10px;
																                                                    "/>
															<button class="btn btn-sm btn-outline" type="submit" style="margin-left: 10px">
																<span class="material-icons-outlined">refresh</span>
															</button>
														</div>
													</form>
												</td>
												<td class="text-end">
													${{ item.product.price }}
												</td>
												<td class="text-end fw-bold pe-4">
													${{ (item.quantity * item.product.price)|number_format(2, '.', ',') }}
												</td>
												<td class="text-center">
													<form method="post" action="{{ path('cart_remove', { itemId: item.id }) }}">
														<button class="btn btn-sm btn-outline-danger rounded-circle" type="submit">
															<span class="material-icons-outlined">delete</span>
														</button>
													</form>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
						<div class="card-footer bg-white">
							<div class="d-flex justify-content-between">
								<a href="{{ path('product_index') }}" class="btn btn-light">
									<span class="material-icons-outlined me-1">arrow_back</span>
									Continue Shopping
								</a>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-4">
					<div class="card shadow-sm">
						<div class="card-header bg-white">
							<h5 class="mb-0">Order Summary</h5>
						</div>

						<div class="card-body">
							<div class="d-flex justify-content-between mb-4">
								<span class="fw-bold">Total</span>
								<span class="fw-bold text-primary fs-5">${{ cart.getTotal()|number_format(2, '.', ',') }}</span>
							</div>

							<div class="d-grid">
								<a href="{{ path('cart_checkout') }}" class="btn btn-primary btn-lg">
									<span class="material-icons-outlined me-2">payment</span>
									Proceed to Checkout
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}
